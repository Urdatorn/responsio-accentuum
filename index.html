---
layout: default
title: Pindar Heatmap Viewer
---

<div class="container">
  <a href="https://github.com/Urdatorn/responsio-accentuum/tree/master" target="_blank" class="github-button">
    <svg class="github-icon" height="20" viewBox="0 0 16 16" width="20" aria-hidden="true">
      <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
    </svg>
    <span>Code</span>
  </a>
  
  <h1>Visualizing constraints on melody in Pindar</h1>
  <p class="subtitle">Select a victory-ode collection and index to view a heatmap</p>
  
  <div class="controls">
    <div class="control-group">
      <label for="collection">Collection:</label>
      <select id="collection" class="select-input">
        <option value="ol">Olympians</option>
        <option value="ne">Nemeans</option>
        <option value="py">Pythians</option>
        <option value="is">Isthmians</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="number">Number:</label>
      <select id="number" class="select-input">
        <!-- Options will be populated dynamically based on collection -->
      </select>
    </div>
    
    <div class="control-group">
      <label for="unit">Responding unit:</label>
      <select id="unit" class="select-input">
        <option value="triads">Triad</option>
        <option value="strophes">Strophe/Antistrophe</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="overlay">Text overlay:</label>
      <select id="overlay" class="select-input">
        <option value="text">Yes</option>
        <option value="notext">No</option>
      </select>
    </div>
  </div>
  
  <div id="debug-info" style="background: #f0f0f0; padding: 10px; margin: 20px 0; border: 1px solid #ccc; font-family: monospace; font-size: 12px;">
    <strong>Debug Info:</strong><br>
    <span id="debug-output">Loading...</span>
  </div>
  
  <div class="image-container">
    <div id="error-message" class="error-message" style="display: none;">
      This heatmap is not available.
    </div>
    <img id="heatmap" src="" alt="Heatmap" style="display: none;">
  </div>
  
  <div class="faq-section">
    {% capture faq_content %}{% include_relative media/heatmaps/faq.md %}{% endcapture %}
    {{ faq_content | markdownify }}
  </div>
</div>

<script>
  // Check if debug mode is enabled via URL parameter (?debug=true)
  const urlParams = new URLSearchParams(window.location.search);
  const debugMode = urlParams.get('debug') === 'true';
  
  // Show/hide debug panel based on URL parameter
  if (!debugMode) {
    const debugPanel = document.getElementById('debug-info');
    if (debugPanel) {
      debugPanel.style.display = 'none';
    }
  }
  
  // Set base URL for GitHub Pages
  // Extract from current URL or use hardcoded value
  const currentPath = window.location.pathname;
  let baseUrl = '';
  
  // If we're on GitHub Pages, the path will be /responsio-accentuum/...
  if (currentPath.startsWith('/responsio-accentuum')) {
    baseUrl = '/responsio-accentuum';
  }
  
  function debugLog(msg) {
    if (!debugMode) return; // Only log if debug mode is enabled
    const debugOutput = document.getElementById('debug-output');
    const currentText = debugOutput.innerHTML === 'Loading...' ? '' : debugOutput.innerHTML;
    debugOutput.innerHTML = currentText + msg + '<br>';
  }
  
  debugLog('Base URL: "' + baseUrl + '"');
  debugLog('Current pathname: ' + currentPath);
  debugLog('Window location: ' + window.location.href);
  
  // Available heatmaps mapping
  const availableHeatmaps = {
    triads: {
      'ol': [1, 2, 3, 5, 6, 7, 8, 9, 10, 13, 14],
      'ne': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
      'py': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
      'is': [1, 2, 4, 5, 6, 7, 8]
    },
    strophes: {
      'ol': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
      'ne': [1, 3, 5, 6, 7, 8, 10, 11],
      'py': [1, 2, 3, 4, 5, 7, 8, 9, 10, 11],
      'is': [1, 2, 3, 4, 5, 6]
    }
  };
  
  // Populate number dropdown based on selected collection and unit
  function updateNumberOptions() {
    const collection = document.getElementById('collection').value;
    const unit = document.getElementById('unit').value;
    const numberSelect = document.getElementById('number');
    const currentValue = numberSelect.value;
    
    // Clear existing options
    numberSelect.innerHTML = '';
    
    // Add options for available heatmaps
    const availableNumbers = availableHeatmaps[unit][collection];
    availableNumbers.forEach(num => {
      const option = document.createElement('option');
      const numStr = num.toString().padStart(2, '0');
      option.value = numStr;
      option.textContent = num.toString();
      numberSelect.appendChild(option);
    });
    
    // Try to keep the same selection if it's still available, otherwise select first
    if (currentValue && availableNumbers.includes(parseInt(currentValue))) {
      numberSelect.value = currentValue;
    } else {
      numberSelect.value = availableNumbers[0].toString().padStart(2, '0');
    }
  }
  
  function updateHeatmap() {
    const collection = document.getElementById('collection').value;
    const numberSelect = document.getElementById('number');
    const number = numberSelect.value;
    const numberInt = parseInt(number);
    const unit = document.getElementById('unit').value;
    const overlay = document.getElementById('overlay').value;
    const img = document.getElementById('heatmap');
    const errorMessage = document.getElementById('error-message');
    
    debugLog('---');
    debugLog('Collection: ' + collection + ', Number: ' + number + ', NumberInt: ' + numberInt);
    debugLog('Unit: ' + unit + ', Overlay: ' + overlay);
    debugLog('Available for ' + collection + ' (' + unit + '): [' + availableHeatmaps[unit][collection].join(', ') + ']');
    debugLog('Is available? ' + availableHeatmaps[unit][collection].includes(numberInt));
    
    // Check if this heatmap is available
    if (availableHeatmaps[unit][collection].includes(numberInt)) {
      const imagePath = baseUrl + `/media/heatmaps/${unit}/${overlay}/${collection}${number}.png`;
      debugLog('Image path: ' + imagePath);
      img.src = imagePath;
      img.alt = `Heatmap for ${collection.toUpperCase()} ${numberInt}`;
      img.style.display = 'block';
      errorMessage.style.display = 'none';
      
      // Check if image actually loads
      img.onerror = function() {
        debugLog('ERROR: Failed to load image!');
        img.style.display = 'none';
        errorMessage.style.display = 'block';
      };
      
      img.onload = function() {
        debugLog('SUCCESS: Image loaded!');
      };
    } else {
      debugLog('ERROR: Heatmap not in available list');
      img.style.display = 'none';
      errorMessage.style.display = 'block';
    }
  }
  
  // Add event listeners
  document.getElementById('collection').addEventListener('change', function() {
    updateNumberOptions();
    updateHeatmap();
  });
  document.getElementById('unit').addEventListener('change', function() {
    updateNumberOptions();
    updateHeatmap();
  });
  document.getElementById('number').addEventListener('change', updateHeatmap);
  document.getElementById('overlay').addEventListener('change', updateHeatmap);
  
  // Initialize number dropdown and load initial heatmap
  updateNumberOptions();
  updateHeatmap();
</script>
