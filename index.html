---
layout: default
title: Pindar Heatmap Viewer
---

<div class="container">
  <a href="https://github.com/Urdatorn/responsio-accentuum/tree/master" target="_blank" class="github-button">
    <svg class="github-icon" height="20" viewBox="0 0 16 16" width="20" aria-hidden="true">
      <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
    </svg>
    <span>Code</span>
  </a>
  
  <h1>Visualizing constraints on melody in Pindar</h1>
  <p class="subtitle">Select a victory-ode collection and index to view a heatmap</p>
  
  <div class="controls">
    <div class="control-group">
      <label for="collection">Collection:</label>
      <select id="collection" class="select-input">
        <option value="ol">Olympians</option>
        <option value="ne">Nemeans</option>
        <option value="py">Pythians</option>
        <option value="is">Isthmians</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="number">Number:</label>
      <select id="number" class="select-input">
        <!-- Options will be populated dynamically based on collection -->
      </select>
    </div>
    
    <div class="control-group">
      <label for="unit">Responding unit:</label>
      <select id="unit" class="select-input">
        <option value="triads">Triad</option>
        <option value="strophes">Strophe/Antistrophe</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="overlay">Text overlay:</label>
      <select id="overlay" class="select-input">
        <option value="text">Yes</option>
        <option value="notext">No</option>
      </select>
    </div>
  </div>
  
  <div id="debug-info" style="background: #f0f0f0; padding: 10px; margin: 20px 0; border: 1px solid #ccc; font-family: monospace; font-size: 12px;">
    <strong>Debug Info:</strong><br>
    <span id="debug-output">Loading...</span>
  </div>
  
  <div class="image-container">
    <div id="error-message" class="error-message" style="display: none;">
      This heatmap is not available.
    </div>
    <div class="heatmap-container" style="display: none;" id="heatmap-container">
      <div class="heatmap-wrapper">
        <h3 class="heatmap-title" id="image-title">Pindar Heatmap</h3>
        <img id="main-image" src="" alt="Heatmap" onclick="toggleImage()">
        <p class="toggle-hint">Click to toggle between Pindar and baseline</p>
        <div class="stats-box" id="current-stats">
          <div class="stat-item">
            <span class="stat-label" id="current-label">Average comp. score:</span>
            <span class="stat-value" id="current-score">-</span>
            <span class="stat-emoji" id="comparison-emoji">ðŸ¤”</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Chi-square Statistical Analysis Section -->
  <div class="section" id="chisquare-section" style="display: none;">
    <h2>Statistical Significance Analysis</h2>
    <p>Chi-square test results comparing observed responsion patterns against prose baseline distributions.</p>
    
    <div class="chisquare-container">
      <div class="chisquare-wrapper">
        <img id="chisquare-graph" src="" alt="Chi-square Analysis">
        <div class="stats-box" id="chisquare-stats">
          <div class="stat-item">
            <span class="stat-label">Chi-square statistic:</span>
            <span class="stat-value" id="chi2-stat">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">P-value:</span>
            <span class="stat-value" id="p-value">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Significance:</span>
            <span class="stat-value" id="significance-emoji">-</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="faq-section">
    {% capture faq_content %}{% include_relative media/heatmaps/faq.md %}{% endcapture %}
    {{ faq_content | markdownify }}
  </div>
</div>

<script>
  // Check if debug mode is enabled via URL parameter (?debug=true)
  const urlParams = new URLSearchParams(window.location.search);
  const debugMode = urlParams.get('debug') === 'true';
  
  // Show/hide debug panel based on URL parameter
  if (!debugMode) {
    const debugPanel = document.getElementById('debug-info');
    if (debugPanel) {
      debugPanel.style.display = 'none';
    }
  }
  
  // Set base URL for GitHub Pages
  // Extract from current URL or use hardcoded value
  const currentPath = window.location.pathname;
  let baseUrl = '';
  
  // If we're on GitHub Pages, the path will be /responsio-accentuum/...
  if (currentPath.startsWith('/responsio-accentuum')) {
    baseUrl = '/responsio-accentuum';
  }
  
  function debugLog(msg) {
    if (!debugMode) return; // Only log if debug mode is enabled
    const debugOutput = document.getElementById('debug-output');
    const currentText = debugOutput.innerHTML === 'Loading...' ? '' : debugOutput.innerHTML;
    debugOutput.innerHTML = currentText + msg + '<br>';
  }
  
  debugLog('Base URL: "' + baseUrl + '"');
  debugLog('Current pathname: ' + currentPath);
  debugLog('Window location: ' + window.location.href);
  
  // Available heatmaps mapping
  const availableHeatmaps = {
    triads: {
      'ol': [1, 2, 3, 5, 6, 7, 8, 9, 10, 13, 14],
      'ne': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
      'py': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
      'is': [1, 2, 4, 5, 6, 7, 8]
    },
    strophes: {
      'ol': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
      'ne': [1, 3, 5, 6, 7, 8, 10, 11],
      'py': [1, 2, 3, 4, 5, 7, 8, 9, 10, 11],
      'is': [1, 2, 3, 4, 5, 6]
    }
  };
  
  // Compatibility scores data
  const odeCompScores = {
    'is01': 0.75, 'is02': 0.8158295281582952, 'is04': 0.7630188679245283, 'is05': 0.7836477987421383,
    'is06': 0.8007662835249042, 'is07': 0.8065476190476191, 'is08': 0.7235841081994928,
    'ne01': 0.7391732283464567, 'ne02': 0.7484848484848485, 'ne03': 0.7587025316455697, 'ne04': 0.7044673539518901,
    'ne05': 0.7774086378737541, 'ne06': 0.7880724174653887, 'ne07': 0.752411575562701, 'ne08': 0.8054567022538552,
    'ne09': 0.6929499072356216, 'ne10': 0.7315960912052117, 'ne11': 0.7840579710144927,
    'ol01': 0.7428385416666666, 'ol02': 0.7459259259259259, 'ol03': 0.7984496124031008, 'ol05': 0.8088578088578089,
    'ol06': 0.7483679525222552, 'ol07': 0.7546391752577319, 'ol08': 0.7442084942084942, 'ol09': 0.7378787878787879,
    'ol10': 0.7277777777777777, 'ol13': 0.7324324324324324, 'ol14': 0.7948717948717948,
    'py01': 0.760806916426513, 'py02': 0.7365384615384616, 'py03': 0.7368421052631579, 'py04': 0.7088210702341137,
    'py05': 0.7582335329341318, 'py06': 0.75, 'py08': 0.7508620689655172, 'py09': 0.739572192513369,
    'py10': 0.7531512605042017, 'py11': 0.7593457943925234, 'py12': 0.7350427350427351
  };
  
  const baselineProseCompScores = {
    'is01': 0.7306122448979592, 'is02': 0.7929984779299848, 'is04': 0.7433962264150944, 'is05': 0.7786163522012578,
    'is06': 0.8026819923371648, 'is07': 0.7886904761904762, 'is08': 0.7320371935756551,
    'ne01': 0.7322834645669292, 'ne02': 0.7242424242424242, 'ne03': 0.7325949367088608, 'ne04': 0.6941580756013745,
    'ne05': 0.7906976744186046, 'ne06': 0.7884615384615384, 'ne07': 0.7466237942122187, 'ne08': 0.7864768683274022,
    'ne09': 0.6846011131725417, 'ne10': 0.7276872964169381, 'ne11': 0.7855072463768116,
    'ol01': 0.7337239583333334, 'ol02': 0.7479245283018868, 'ol03': 0.7919896640826873, 'ol05': 0.7878787878787878,
    'ol06': 0.7311572700296736, 'ol07': 0.7381443298969073, 'ol08': 0.7364864864864865, 'ol09': 0.7484848484848485,
    'ol10': 0.7396825396825397, 'ol13': 0.75, 'ol14': 0.8173076923076923,
    'py01': 0.7371757925072047, 'py02': 0.7301282051282051, 'py03': 0.7409356725146199, 'py04': 0.6872909698996655,
    'py05': 0.7484984984984985, 'py06': 0.7222222222222222, 'py08': 0.7482758620689656, 'py09': 0.7374331550802139,
    'py10': 0.7447478991596639, 'py11': 0.7394859813084113, 'py12': 0.7521367521367521
  };
  
  const chisquareData = {
    'is01': [2.999194, 2, 2.23e-01, [0.5, 0.75, 1.0], [69, 107, 69], 245, [77.0, 110.0, 58.0]],
    'is02': [4.365255, 1, 3.67e-02, [0.6666666666666666, 1.0], [121, 98], 219, [136.0, 83.0]],
    'is04': [6.783868, 2, 3.36e-02, [0.6, 0.8, 1.0], [98, 118, 49], 265, [119.0, 102.0, 44.0]],
    'is05': [0.270684, 1, 6.03e-01, [0.6666666666666666, 1.0], [172, 93], 265, [176.0, 89.0]],
    'is06': [0.047586, 1, 8.27e-01, [0.6666666666666666, 1.0], [208, 140], 348, [206.0, 142.0]],
    'is07': [2.770182, 1, 9.60e-02, [0.6666666666666666, 1.0], [130, 94], 224, [142.0, 82.0]],
    'is08': [3.583366, 3, 3.10e-01, [0.5714285714285714, 0.7142857142857143, 0.8571428571428571, 1.0], [66, 46, 37, 20], 169, [56.00000000000001, 54.00000000000001, 41.0, 18.0]],
    'ne01': [0.684969, 2, 7.10e-01, [0.5, 0.75, 1.0], [77, 111, 66], 254, [83.0, 106.0, 65.0]],
    'ne02': [2.248366, 2, 3.25e-01, [0.6, 0.8, 1.0], [30, 23, 13], 66, [34.0, 23.0, 9.0]],
    'ne03': [7.080294, 2, 2.90e-02, [0.5, 0.75, 1.0], [72, 161, 83], 316, [92.0, 154.0, 70.0]],
    'ne04': [6.363312, 6, 3.84e-01, [0.5, 0.5833333333333334, 0.6666666666666666, 0.75, 0.8333333333333334, 0.9166666666666666, 1.0], [10, 19, 29, 12, 14, 9, 4], 97, [13.999999999999998, 20.0, 22.0, 18.0, 11.0, 8.0, 4.0]],
    'ne05': [2.047619, 1, 1.52e-01, [0.6666666666666666, 1.0], [201, 100], 301, [189.0, 112.0]],
    'ne06': [0.001839, 1, 9.66e-01, [0.6666666666666666, 1.0], [199, 114], 313, [198.6346153846154, 114.36538461538461]],
    'ne07': [0.508288, 2, 7.76e-01, [0.6, 0.8, 1.0], [130, 125, 56], 311, [136.0, 122.0, 53.0]],
    'ne08': [3.956876, 1, 4.67e-02, [0.6666666666666666, 1.0], [164, 117], 281, [180.0, 101.0]],
    'ne09': [3.082191, 5, 6.87e-01, [0.5454545454545454, 0.6363636363636364, 0.7272727272727273, 0.8181818181818182, 0.9090909090909091, 1.0], [28, 22, 22, 15, 7, 4], 98, [29.0, 26.0, 20.0, 11.0, 9.0, 3.0]],
    'ne10': [7.469898, 2, 2.39e-02, [0.6, 0.8, 1.0], [146, 120, 41], 307, [160.0, 97.99999999999999, 48.99999999999999]],
    'ne11': [0.018952, 1, 8.91e-01, [0.6666666666666666, 1.0], [149, 81], 230, [148.0, 82.0]],
    'ol01': [3.231305, 2, 1.99e-01, [0.5, 0.75, 1.0], [119, 157, 108], 384, [119.0, 171.0, 94.0]],
    'ol02': [1.250403, 2, 5.35e-01, [0.6, 0.8, 1.0], [128, 87, 55], 270, [122.26415094339623, 95.77358490566037, 51.9622641509434]],
    'ol03': [0.413011, 1, 5.20e-01, [0.6666666666666666, 1.0], [156, 102], 258, [161.0, 97.0]],
    'ol05': [2.447802, 1, 1.18e-01, [0.6666666666666666, 1.0], [82, 61], 143, [91.0, 52.0]],
    'ol06': [5.636556, 2, 5.97e-02, [0.6, 0.8, 1.0], [159, 106, 72], 337, [172.0, 109.0, 56.0]],
    'ol07': [4.458300, 2, 1.08e-01, [0.6, 0.8, 1.0], [123, 111, 57], 291, [141.0, 99.0, 51.0]],
    'ol08': [0.490365, 2, 7.83e-01, [0.5, 0.75, 1.0], [69, 127, 63], 259, [73.0, 127.0, 59.0]],
    'ol09': [1.829505, 2, 4.01e-01, [0.5, 0.75, 1.0], [105, 136, 89], 330, [94.0, 144.0, 92.0]],
    'ol10': [5.103875, 2, 7.79e-02, [0.6, 0.8, 1.0], [125, 93, 34], 252, [123.0, 82.0, 47.0]],
    'ol13': [5.505321, 2, 6.38e-02, [0.6, 0.8, 1.0], [149, 98, 49], 296, [129.0, 112.0, 55.0]],
    'ol14': [1.354599, 1, 2.44e-01, [0.5, 1.0], [64, 92], 156, [57.0, 99.0]],
    'py01': [8.651332, 2, 1.32e-02, [0.6, 0.8, 1.0], [144, 127, 76], 347, [169.0, 118.00000000000001, 60.0]],
    'py02': [0.519744, 2, 7.71e-01, [0.5, 0.75, 1.0], [110, 191, 89], 390, [116.0, 189.0, 85.0]],
    'py03': [2.360340, 2, 3.07e-01, [0.6, 0.8, 1.0], [164, 122, 56], 342, [166.0, 111.0, 65.0]],
    'py04': [37.223721, 6, 1.59e-06, [0.5384615384615384, 0.6153846153846154, 0.6923076923076923, 0.7692307692307693, 0.8461538461538461, 0.9230769230769231, 1.0], [76, 79, 61, 59, 43, 35, 15], 368, [96.0, 74.0, 77.0, 51.0, 37.0, 15.0, 18.0]],
    'py05': [1.508453, 2, 4.70e-01, [0.5, 0.75, 1.0], [83, 157, 94], 334, [86.25825825825827, 163.4894894894895, 84.25225225225225]],
    'py06': [3.557190, 3, 3.13e-01, [0.5, 0.6666666666666666, 0.8333333333333334, 1.0], [17, 31, 31, 17], 96, [25.0, 29.0, 27.0, 15.0]],
    'py08': [0.914627, 2, 6.33e-01, [0.6, 0.8, 1.0], [99, 91, 42], 232, [104.0, 84.0, 44.0]],
    'py09': [3.210634, 2, 2.01e-01, [0.6, 0.8, 1.0], [176, 135, 63], 374, [186.0, 119.0, 69.0]],
    'py10': [1.650457, 2, 4.38e-01, [0.5, 0.75, 1.0], [63, 109, 66], 238, [63.0, 117.0, 58.0]],
    'py11': [3.482926, 2, 1.75e-01, [0.5, 0.75, 1.0], [60, 86, 68], 214, [65.0, 93.0, 55.99999999999999]],
    'py12': [1.553904, 2, 4.60e-01, [0.5, 0.75, 1.0], [38, 48, 31], 117, [32.0, 52.0, 33.0]]
  };
  
  // Populate number dropdown based on selected collection and unit
  function updateNumberOptions() {
    const collection = document.getElementById('collection').value;
    const unit = document.getElementById('unit').value;
    const numberSelect = document.getElementById('number');
    const currentValue = numberSelect.value;
    
    // Clear existing options
    numberSelect.innerHTML = '';
    
    // Add options for available heatmaps
    const availableNumbers = availableHeatmaps[unit][collection];
    availableNumbers.forEach(num => {
      const option = document.createElement('option');
      const numStr = num.toString().padStart(2, '0');
      option.value = numStr;
      option.textContent = num.toString();
      numberSelect.appendChild(option);
    });
    
    // Try to keep the same selection if it's still available, otherwise select first
    if (currentValue && availableNumbers.includes(parseInt(currentValue))) {
      numberSelect.value = currentValue;
    } else {
      numberSelect.value = availableNumbers[0].toString().padStart(2, '0');
    }
  }
  
  function updateHeatmap() {
    const collection = document.getElementById('collection').value;
    const numberSelect = document.getElementById('number');
    const number = numberSelect.value;
    const numberInt = parseInt(number);
    const unit = document.getElementById('unit').value;
    const overlay = document.getElementById('overlay').value;
    const heatmapContainer = document.getElementById('heatmap-container');
    const mainImg = document.getElementById('main-image');
    const errorMessage = document.getElementById('error-message');
    
    debugLog('---');
    debugLog('Collection: ' + collection + ', Number: ' + number + ', NumberInt: ' + numberInt);
    debugLog('Unit: ' + unit + ', Overlay: ' + overlay);
    debugLog('Available for ' + collection + ' (' + unit + '): [' + availableHeatmaps[unit][collection].join(', ') + ']');
    debugLog('Is available? ' + availableHeatmaps[unit][collection].includes(numberInt));
    
    // Check if this heatmap is available
    if (availableHeatmaps[unit][collection].includes(numberInt)) {
      const heatmapPath = `/responsio-accentuum/media/heatmaps/${unit}/${overlay}/${collection}${number}.png`;
      const baselinePath = `/responsio-accentuum/media/heatmaps/${unit}/baselines/${collection}${number}.png`;
      
      debugLog('Heatmap path: ' + heatmapPath);
      debugLog('Baseline path: ' + baselinePath);
      
      // Update stats variables
      const responsionAttribute = collection + number;
      const odeScore = odeCompScores[responsionAttribute];
      const baselineScore = baselineProseCompScores[responsionAttribute];
      
      // Store paths for toggle functionality  
      window.currentHeatmapPath = heatmapPath;
      window.currentBaselinePath = baselinePath;
      window.showingHeatmap = true; // Start with heatmap
      
      // Set up initial image (heatmap)
      mainImg.src = heatmapPath;
      mainImg.alt = `${collection.toUpperCase()} ${numberInt} Heatmap`;
      
      // Store scores for toggle functionality
      window.currentOdeScore = odeScore;
      window.currentBaselineScore = baselineScore;
      window.currentResponsionAttribute = responsionAttribute;
      
      // Update display for current image (heatmap)
      updateImageDisplay();
      
      // Update chi-square analysis section
      updateChisquareSection(responsionAttribute);
      
      // Handle image load
      mainImg.onload = function() {
        heatmapContainer.style.display = 'block';
        errorMessage.style.display = 'none';
        debugLog('SUCCESS: Image loaded!');
      };
      
      mainImg.onerror = function() {
        debugLog('ERROR: Failed to load image!');
        heatmapContainer.style.display = 'none';
        errorMessage.style.display = 'block';
      };
      
    } else {
      debugLog('ERROR: Heatmap not available!');
      heatmapContainer.style.display = 'none';
      errorMessage.style.display = 'block';
    }
  }
  
  // Function to toggle between heatmap and baseline
  function toggleImage() {
    if (!window.currentHeatmapPath || !window.currentBaselinePath) return;
    
    const mainImg = document.getElementById('main-image');
    
    if (window.showingHeatmap) {
      // Switch to baseline
      mainImg.src = window.currentBaselinePath;
      mainImg.alt = mainImg.alt.replace('Heatmap', 'Baseline');
      window.showingHeatmap = false;
    } else {
      // Switch back to heatmap
      mainImg.src = window.currentHeatmapPath;
      mainImg.alt = mainImg.alt.replace('Baseline', 'Heatmap');
      window.showingHeatmap = true;
    }
    
    // Update display
    updateImageDisplay();
    
    debugLog('Toggled to: ' + (window.showingHeatmap ? 'Heatmap' : 'Baseline'));
  }
  
  // Function to update the display based on current image
  function updateImageDisplay() {
    const imageTitle = document.getElementById('image-title');
    const currentLabel = document.getElementById('current-label');
    const currentScore = document.getElementById('current-score');
    const emojiElement = document.getElementById('comparison-emoji');
    
    if (window.showingHeatmap) {
      imageTitle.textContent = 'Pindar Heatmap';
      currentLabel.textContent = 'Average comp. score:';
      currentScore.textContent = window.currentOdeScore ? window.currentOdeScore.toFixed(2) : 'N/A';
    } else {
      imageTitle.textContent = 'Baseline Heatmap';
      currentLabel.textContent = 'Average baseline score:';
      currentScore.textContent = window.currentBaselineScore ? window.currentBaselineScore.toFixed(2) : 'N/A';
    }
    
    // Update emoji based on comparison (always shows comparison regardless of current view)
    if (window.currentOdeScore && window.currentBaselineScore) {
      if (window.currentOdeScore > window.currentBaselineScore) {
        emojiElement.textContent = 'ðŸ˜Š'; // Happy emoji - Pindar scores higher
        emojiElement.title = 'Pindar scores higher than baseline!';
      } else {
        emojiElement.textContent = 'ðŸ˜”'; // Sad emoji - Baseline scores higher
        emojiElement.title = 'Baseline scores higher than Pindar';
      }
    } else {
      emojiElement.textContent = 'ðŸ¤”'; // Thinking emoji - missing data
      emojiElement.title = 'Data unavailable';
    }
  }
  
  // Function to update chi-square statistical analysis section
  function updateChisquareSection(responsionAttribute) {
    const chisquareSection = document.getElementById('chisquare-section');
    const chisquareImg = document.getElementById('chisquare-graph');
    
    // Check if chi-square data exists for this ode
    if (chisquareData[responsionAttribute]) {
      const [chi2Stat, dof, pValue, keys, obsCount, obsTotal, expCounts] = chisquareData[responsionAttribute];
      
      // Set up image path
      const chisquarePath = `/responsio-accentuum/media/significance/chisquare_${responsionAttribute}.png`;
      chisquareImg.src = chisquarePath;
      chisquareImg.alt = `Chi-square Analysis for ${responsionAttribute.toUpperCase()}`;
      
      // Update statistics
      document.getElementById('chi2-stat').textContent = chi2Stat.toFixed(3);
      document.getElementById('p-value').textContent = pValue.toExponential(2);
      
      // Update significance emoji based on p-value
      const significanceEmoji = document.getElementById('significance-emoji');
      if (pValue < 0.001) {
        significanceEmoji.textContent = 'ðŸ”¥'; // Highly significant
        significanceEmoji.title = 'Highly significant (p < 0.001)';
      } else if (pValue < 0.01) {
        significanceEmoji.textContent = 'â­'; // Very significant
        significanceEmoji.title = 'Very significant (p < 0.01)';
      } else if (pValue < 0.05) {
        significanceEmoji.textContent = 'âœ…'; // Significant
        significanceEmoji.title = 'Significant (p < 0.05)';
      } else if (pValue < 0.10) {
        significanceEmoji.textContent = 'ðŸ¤'; // Marginally significant
        significanceEmoji.title = 'Marginally significant (p < 0.10)';
      } else {
        significanceEmoji.textContent = 'âŒ'; // Not significant
        significanceEmoji.title = 'Not significant (p â‰¥ 0.10)';
      }
      
      // Show the chi-square section
      chisquareSection.style.display = 'block';
      
      debugLog('Chi-square data loaded for ' + responsionAttribute);
      debugLog('Chi2: ' + chi2Stat + ', p-value: ' + pValue);
    } else {
      // Hide section if no data available
      chisquareSection.style.display = 'none';
      debugLog('No chi-square data available for ' + responsionAttribute);
    }
  }
  
  // Add event listeners
  document.getElementById('collection').addEventListener('change', function() {
    updateNumberOptions();
    updateHeatmap();
  });
  document.getElementById('unit').addEventListener('change', function() {
    updateNumberOptions();
    updateHeatmap();
  });
  document.getElementById('number').addEventListener('change', updateHeatmap);
  document.getElementById('overlay').addEventListener('change', updateHeatmap);
  
  // Initialize number dropdown and load initial heatmap
  updateNumberOptions();
  updateHeatmap();
</script>
