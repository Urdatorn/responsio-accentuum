---
layout: default
title: Pindar Heatmap Viewer
---

<div class="container">
  <h1>Pindar Heatmap Viewer</h1>
  <p class="subtitle">Select an ode collection and number to view its heatmap</p>
  
  <div class="controls">
    <div class="control-group">
      <label for="collection">Collection:</label>
      <select id="collection" class="select-input">
        <option value="ol">Olympians</option>
        <option value="ne">Nemeans</option>
        <option value="py">Pythians</option>
        <option value="is">Isthmians</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="number">Number:</label>
      <select id="number" class="select-input">
        <option value="01">1</option>
        <option value="02">2</option>
        <option value="03">3</option>
        <option value="04">4</option>
        <option value="05">5</option>
        <option value="06">6</option>
        <option value="07">7</option>
        <option value="08">8</option>
        <option value="09">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="unit">Responding unit:</label>
      <select id="unit" class="select-input">
        <option value="triads">Triad</option>
        <option value="strophes">Strophe/Antistrophe</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="overlay">Text overlay:</label>
      <select id="overlay" class="select-input">
        <option value="text">Yes</option>
        <option value="notext">No</option>
      </select>
    </div>
  </div>
  
  <div id="debug-info" style="background: #f0f0f0; padding: 10px; margin: 20px 0; border: 1px solid #ccc; font-family: monospace; font-size: 12px;">
    <strong>Debug Info:</strong><br>
    <span id="debug-output">Loading...</span>
  </div>
  
  <div class="image-container">
    <div id="error-message" class="error-message" style="display: none;">
      This heatmap is not available.
    </div>
    <img id="heatmap" src="" alt="Heatmap" style="display: none;">
  </div>
</div>

<script>
  // Check if debug mode is enabled via URL parameter (?debug=true)
  const urlParams = new URLSearchParams(window.location.search);
  const debugMode = urlParams.get('debug') === 'true';
  
  // Show/hide debug panel based on URL parameter
  if (!debugMode) {
    const debugPanel = document.getElementById('debug-info');
    if (debugPanel) {
      debugPanel.style.display = 'none';
    }
  }
  
  // Set base URL for GitHub Pages
  // Extract from current URL or use hardcoded value
  const currentPath = window.location.pathname;
  let baseUrl = '';
  
  // If we're on GitHub Pages, the path will be /responsio-accentuum/...
  if (currentPath.startsWith('/responsio-accentuum')) {
    baseUrl = '/responsio-accentuum';
  }
  
  function debugLog(msg) {
    if (!debugMode) return; // Only log if debug mode is enabled
    const debugOutput = document.getElementById('debug-output');
    const currentText = debugOutput.innerHTML === 'Loading...' ? '' : debugOutput.innerHTML;
    debugOutput.innerHTML = currentText + msg + '<br>';
  }
  
  debugLog('Base URL: "' + baseUrl + '"');
  debugLog('Current pathname: ' + currentPath);
  debugLog('Window location: ' + window.location.href);
  
  // Available heatmaps mapping
  const availableHeatmaps = {
    'ol': [1, 2],
    'ne': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    'py': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
    'is': [1, 2, 4, 5, 6, 7, 8]
  };
  
  function updateHeatmap() {
    const collection = document.getElementById('collection').value;
    const numberSelect = document.getElementById('number');
    const number = numberSelect.value;
    const numberInt = parseInt(number);
    const unit = document.getElementById('unit').value;
    const overlay = document.getElementById('overlay').value;
    const img = document.getElementById('heatmap');
    const errorMessage = document.getElementById('error-message');
    
    debugLog('---');
    debugLog('Collection: ' + collection + ', Number: ' + number + ', NumberInt: ' + numberInt);
    debugLog('Unit: ' + unit + ', Overlay: ' + overlay);
    debugLog('Available for ' + collection + ': [' + availableHeatmaps[collection].join(', ') + ']');
    debugLog('Is available? ' + availableHeatmaps[collection].includes(numberInt));
    
    // Check if this heatmap is available
    if (availableHeatmaps[collection].includes(numberInt)) {
      const imagePath = baseUrl + `/media/heatmaps/${unit}/${overlay}/${collection}${number}.png`;
      debugLog('Image path: ' + imagePath);
      img.src = imagePath;
      img.alt = `Heatmap for ${collection.toUpperCase()} ${numberInt}`;
      img.style.display = 'block';
      errorMessage.style.display = 'none';
      
      // Check if image actually loads
      img.onerror = function() {
        debugLog('ERROR: Failed to load image!');
        img.style.display = 'none';
        errorMessage.style.display = 'block';
      };
      
      img.onload = function() {
        debugLog('SUCCESS: Image loaded!');
      };
    } else {
      debugLog('ERROR: Heatmap not in available list');
      img.style.display = 'none';
      errorMessage.style.display = 'block';
    }
  }
  
  // Add event listeners
  document.getElementById('collection').addEventListener('change', updateHeatmap);
  document.getElementById('number').addEventListener('change', updateHeatmap);
  document.getElementById('unit').addEventListener('change', updateHeatmap);
  document.getElementById('overlay').addEventListener('change', updateHeatmap);
  
  // Load initial heatmap
  updateHeatmap();
</script>
