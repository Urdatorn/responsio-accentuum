---
layout: default
title: Pindar Heatmap Viewer
---

<style>
  /* Inline critical styles to ensure visibility */
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', Roboto, sans-serif !important;
  }
  .css-loaded-indicator {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #34c759;
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    z-index: 1000;
    display: none;
  }
</style>

<div class="css-loaded-indicator" id="css-indicator">✓ CSS Loaded</div>

<div class="container">
  <h1>Pindar Heatmap Viewer</h1>
  <p class="subtitle">Select an ode collection and number to view its heatmap</p>
  
  <div class="controls">
    <div class="control-group">
      <label for="collection">Collection:</label>
      <select id="collection" class="select-input">
        <option value="ol">Olympians</option>
        <option value="ne">Nemeans</option>
        <option value="py">Pythians</option>
        <option value="is">Isthmians</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="number">Number:</label>
      <select id="number" class="select-input">
        <option value="01">1</option>
        <option value="02">2</option>
        <option value="03">3</option>
        <option value="04">4</option>
        <option value="05">5</option>
        <option value="06">6</option>
        <option value="07">7</option>
        <option value="08">8</option>
        <option value="09">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
      </select>
    </div>
  </div>
  
  <div id="debug-info" style="background: #f0f0f0; padding: 10px; margin: 20px 0; border: 1px solid #ccc; font-family: monospace; font-size: 12px;">
    <strong>Debug Info:</strong><br>
    <span id="debug-output">Loading...</span>
  </div>
  
  <div class="image-container">
    <div id="error-message" class="error-message" style="display: none;">
      This heatmap is not available.
    </div>
    <img id="heatmap" src="" alt="Heatmap" style="display: none;">
  </div>
</div>

<script>
  // Check if external CSS is loaded
  window.addEventListener('load', function() {
    const container = document.querySelector('.container');
    const computedStyle = window.getComputedStyle(container);
    const indicator = document.getElementById('css-indicator');
    
    // Check if the iOS-style border-radius is applied
    if (computedStyle.borderRadius === '18px') {
      indicator.style.display = 'block';
      indicator.textContent = '✓ CSS Loaded';
    } else {
      indicator.style.display = 'block';
      indicator.style.background = '#ff3b30';
      indicator.textContent = '⚠ CSS Not Loaded';
    }
  });
  
  // Set base URL for GitHub Pages
  // Extract from current URL or use hardcoded value
  const currentPath = window.location.pathname;
  let baseUrl = '';
  
  // If we're on GitHub Pages, the path will be /responsio-accentuum/...
  if (currentPath.startsWith('/responsio-accentuum')) {
    baseUrl = '/responsio-accentuum';
  }
  
  function debugLog(msg) {
    const debugOutput = document.getElementById('debug-output');
    const currentText = debugOutput.innerHTML === 'Loading...' ? '' : debugOutput.innerHTML;
    debugOutput.innerHTML = currentText + msg + '<br>';
  }
  
  debugLog('Base URL: "' + baseUrl + '"');
  debugLog('Current pathname: ' + currentPath);
  debugLog('Window location: ' + window.location.href);
  
  // Available heatmaps mapping
  const availableHeatmaps = {
    'ol': [1, 2],
    'ne': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    'py': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
    'is': [1, 2, 4, 5, 6, 7, 8]
  };
  
  function updateHeatmap() {
    const collection = document.getElementById('collection').value;
    const numberSelect = document.getElementById('number');
    const number = numberSelect.value;
    const numberInt = parseInt(number);
    const img = document.getElementById('heatmap');
    const errorMessage = document.getElementById('error-message');
    
    debugLog('---');
    debugLog('Collection: ' + collection + ', Number: ' + number + ', NumberInt: ' + numberInt);
    debugLog('Available for ' + collection + ': [' + availableHeatmaps[collection].join(', ') + ']');
    debugLog('Is available? ' + availableHeatmaps[collection].includes(numberInt));
    
    // Check if this heatmap is available
    if (availableHeatmaps[collection].includes(numberInt)) {
      const imagePath = baseUrl + `/media/plots/heatmaps/${collection}${number}.png`;
      debugLog('Image path: ' + imagePath);
      img.src = imagePath;
      img.alt = `Heatmap for ${collection.toUpperCase()} ${numberInt}`;
      img.style.display = 'block';
      errorMessage.style.display = 'none';
      
      // Check if image actually loads
      img.onerror = function() {
        debugLog('ERROR: Failed to load image!');
        img.style.display = 'none';
        errorMessage.style.display = 'block';
      };
      
      img.onload = function() {
        debugLog('SUCCESS: Image loaded!');
      };
    } else {
      debugLog('ERROR: Heatmap not in available list');
      img.style.display = 'none';
      errorMessage.style.display = 'block';
    }
  }
  
  // Add event listeners
  document.getElementById('collection').addEventListener('change', updateHeatmap);
  document.getElementById('number').addEventListener('change', updateHeatmap);
  
  // Load initial heatmap
  updateHeatmap();
</script>
