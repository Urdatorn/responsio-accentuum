---
layout: default
title: Pindar Heatmap Viewer
---

<div class="container">
  <a href="https://github.com/Urdatorn/responsio-accentuum/tree/master" target="_blank" class="github-button">
    <svg class="github-icon" height="20" viewBox="0 0 16 16" width="20" aria-hidden="true">
      <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
    </svg>
    <span>Code</span>
  </a>
  
  <h1>Visualizing constraints on melody in Pindar</h1>
  <p class="subtitle">Select a victory-ode collection and index to view a heatmap</p>
  
  <div class="controls">
    <div class="control-group">
      <label for="collection">Collection:</label>
      <select id="collection" class="select-input">
        <option value="ol">Olympians</option>
        <option value="ne">Nemeans</option>
        <option value="py">Pythians</option>
        <option value="is">Isthmians</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="number">Number:</label>
      <select id="number" class="select-input">
        <!-- Options will be populated dynamically based on collection -->
      </select>
    </div>
    
    <div class="control-group">
      <label for="unit">Responding unit:</label>
      <select id="unit" class="select-input">
        <option value="triads">Triad</option>
        <option value="strophes">Strophe/Antistrophe</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="overlay">Text overlay:</label>
      <select id="overlay" class="select-input">
        <option value="text">Yes</option>
        <option value="notext">No</option>
      </select>
    </div>
  </div>
  
  <div id="debug-info" style="background: #f0f0f0; padding: 10px; margin: 20px 0; border: 1px solid #ccc; font-family: monospace; font-size: 12px;">
    <strong>Debug Info:</strong><br>
    <span id="debug-output">Loading...</span>
  </div>
  
  <div class="image-container">
    <div id="error-message" class="error-message" style="display: none;">
      This heatmap is not available.
    </div>
    <div class="heatmap-pair" style="display: none;" id="heatmap-pair">
      <div class="heatmap-wrapper">
        <img id="heatmap" src="" alt="Heatmap">
        <div class="stats-box" id="pindar-stats">
          <div class="stat-item">
            <span class="stat-label">Average comp. score:</span>
            <span class="stat-value" id="ode-score">-</span>
            <span class="stat-emoji" id="comparison-emoji">ðŸ¤”</span>
          </div>
        </div>
      </div>
      <div class="heatmap-wrapper">
        <img id="baseline" src="" alt="Baseline Heatmap">
        <div class="stats-box" id="baseline-stats">
          <div class="stat-item">
            <span class="stat-label">Average baseline score:</span>
            <span class="stat-value" id="baseline-score">-</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal for fullscreen image -->
  <div class="modal" id="image-modal" style="display: none;">
    <div class="modal-overlay" id="modal-overlay"></div>
    <div class="modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <img id="modal-image" src="" alt="Fullscreen Image">
    </div>
  </div>
  
  <div class="faq-section">
    {% capture faq_content %}{% include_relative media/heatmaps/faq.md %}{% endcapture %}
    {{ faq_content | markdownify }}
  </div>
</div>

<script>
  // Check if debug mode is enabled via URL parameter (?debug=true)
  const urlParams = new URLSearchParams(window.location.search);
  const debugMode = urlParams.get('debug') === 'true';
  
  // Show/hide debug panel based on URL parameter
  if (!debugMode) {
    const debugPanel = document.getElementById('debug-info');
    if (debugPanel) {
      debugPanel.style.display = 'none';
    }
  }
  
  // Set base URL for GitHub Pages
  // Extract from current URL or use hardcoded value
  const currentPath = window.location.pathname;
  let baseUrl = '';
  
  // If we're on GitHub Pages, the path will be /responsio-accentuum/...
  if (currentPath.startsWith('/responsio-accentuum')) {
    baseUrl = '/responsio-accentuum';
  }
  
  function debugLog(msg) {
    if (!debugMode) return; // Only log if debug mode is enabled
    const debugOutput = document.getElementById('debug-output');
    const currentText = debugOutput.innerHTML === 'Loading...' ? '' : debugOutput.innerHTML;
    debugOutput.innerHTML = currentText + msg + '<br>';
  }
  
  debugLog('Base URL: "' + baseUrl + '"');
  debugLog('Current pathname: ' + currentPath);
  debugLog('Window location: ' + window.location.href);
  
  // Available heatmaps mapping
  const availableHeatmaps = {
    triads: {
      'ol': [1, 2, 3, 5, 6, 7, 8, 9, 10, 13, 14],
      'ne': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
      'py': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
      'is': [1, 2, 4, 5, 6, 7, 8]
    },
    strophes: {
      'ol': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
      'ne': [1, 3, 5, 6, 7, 8, 10, 11],
      'py': [1, 2, 3, 4, 5, 7, 8, 9, 10, 11],
      'is': [1, 2, 3, 4, 5, 6]
    }
  };
  
  // Compatibility scores data
  const odeCompScores = {
    'is01': 0.75, 'is02': 0.8158295281582952, 'is04': 0.7630188679245283, 'is05': 0.7836477987421383,
    'is06': 0.8007662835249042, 'is07': 0.8065476190476191, 'is08': 0.7235841081994928,
    'ne01': 0.7391732283464567, 'ne02': 0.7484848484848485, 'ne03': 0.7587025316455697, 'ne04': 0.7044673539518901,
    'ne05': 0.7774086378737541, 'ne06': 0.7880724174653887, 'ne07': 0.752411575562701, 'ne08': 0.8054567022538552,
    'ne09': 0.6929499072356216, 'ne10': 0.7315960912052117, 'ne11': 0.7840579710144927,
    'ol01': 0.7428385416666666, 'ol02': 0.7459259259259259, 'ol03': 0.7984496124031008, 'ol05': 0.8088578088578089,
    'ol06': 0.7483679525222552, 'ol07': 0.7546391752577319, 'ol08': 0.7442084942084942, 'ol09': 0.7378787878787879,
    'ol10': 0.7277777777777777, 'ol13': 0.7324324324324324, 'ol14': 0.7948717948717948,
    'py01': 0.760806916426513, 'py02': 0.7365384615384616, 'py03': 0.7368421052631579, 'py04': 0.7088210702341137,
    'py05': 0.7582335329341318, 'py06': 0.75, 'py08': 0.7508620689655172, 'py09': 0.739572192513369,
    'py10': 0.7531512605042017, 'py11': 0.7593457943925234, 'py12': 0.7350427350427351
  };
  
  const baselineProseCompScores = {
    'is01': 0.7306122448979592, 'is02': 0.7929984779299848, 'is04': 0.7433962264150944, 'is05': 0.7786163522012578,
    'is06': 0.8026819923371648, 'is07': 0.7886904761904762, 'is08': 0.7320371935756551,
    'ne01': 0.7322834645669292, 'ne02': 0.7242424242424242, 'ne03': 0.7325949367088608, 'ne04': 0.6941580756013745,
    'ne05': 0.7906976744186046, 'ne06': 0.7884615384615384, 'ne07': 0.7466237942122187, 'ne08': 0.7864768683274022,
    'ne09': 0.6846011131725417, 'ne10': 0.7276872964169381, 'ne11': 0.7855072463768116,
    'ol01': 0.7337239583333334, 'ol02': 0.7479245283018868, 'ol03': 0.7919896640826873, 'ol05': 0.7878787878787878,
    'ol06': 0.7311572700296736, 'ol07': 0.7381443298969073, 'ol08': 0.7364864864864865, 'ol09': 0.7484848484848485,
    'ol10': 0.7396825396825397, 'ol13': 0.75, 'ol14': 0.8173076923076923,
    'py01': 0.7371757925072047, 'py02': 0.7301282051282051, 'py03': 0.7409356725146199, 'py04': 0.6872909698996655,
    'py05': 0.7484984984984985, 'py06': 0.7222222222222222, 'py08': 0.7482758620689656, 'py09': 0.7374331550802139,
    'py10': 0.7447478991596639, 'py11': 0.7394859813084113, 'py12': 0.7521367521367521
  };
  
  // Populate number dropdown based on selected collection and unit
  function updateNumberOptions() {
    const collection = document.getElementById('collection').value;
    const unit = document.getElementById('unit').value;
    const numberSelect = document.getElementById('number');
    const currentValue = numberSelect.value;
    
    // Clear existing options
    numberSelect.innerHTML = '';
    
    // Add options for available heatmaps
    const availableNumbers = availableHeatmaps[unit][collection];
    availableNumbers.forEach(num => {
      const option = document.createElement('option');
      const numStr = num.toString().padStart(2, '0');
      option.value = numStr;
      option.textContent = num.toString();
      numberSelect.appendChild(option);
    });
    
    // Try to keep the same selection if it's still available, otherwise select first
    if (currentValue && availableNumbers.includes(parseInt(currentValue))) {
      numberSelect.value = currentValue;
    } else {
      numberSelect.value = availableNumbers[0].toString().padStart(2, '0');
    }
  }
  
  function updateHeatmap() {
    const collection = document.getElementById('collection').value;
    const numberSelect = document.getElementById('number');
    const number = numberSelect.value;
    const numberInt = parseInt(number);
    const unit = document.getElementById('unit').value;
    const overlay = document.getElementById('overlay').value;
    const heatmapImg = document.getElementById('heatmap');
    const baselineImg = document.getElementById('baseline');
    const heatmapPair = document.getElementById('heatmap-pair');
    const errorMessage = document.getElementById('error-message');
    
    debugLog('---');
    debugLog('Collection: ' + collection + ', Number: ' + number + ', NumberInt: ' + numberInt);
    debugLog('Unit: ' + unit + ', Overlay: ' + overlay);
    debugLog('Available for ' + collection + ' (' + unit + '): [' + availableHeatmaps[unit][collection].join(', ') + ']');
    debugLog('Is available? ' + availableHeatmaps[unit][collection].includes(numberInt));
    
    // Check if this heatmap is available
    if (availableHeatmaps[unit][collection].includes(numberInt)) {
      const heatmapPath = `/responsio-accentuum/media/heatmaps/${unit}/${overlay}/${collection}${number}.png`;
      const baselinePath = `/responsio-accentuum/media/heatmaps/${unit}/baselines/${collection}${number}.png`;
      
      debugLog('Heatmap path: ' + heatmapPath);
      debugLog('Baseline path: ' + baselinePath);
      
      // Set up image sources
      heatmapImg.src = heatmapPath;
      heatmapImg.alt = `${collection.toUpperCase()} ${numberInt} Heatmap`;
      baselineImg.src = baselinePath;
      baselineImg.alt = `${collection.toUpperCase()} ${numberInt} Baseline`;
      
      // Update stats
      const responsionAttribute = collection + number;
      const odeScore = odeCompScores[responsionAttribute];
      const baselineScore = baselineProseCompScores[responsionAttribute];
      
      document.getElementById('ode-score').textContent = odeScore ? odeScore.toFixed(2) : 'N/A';
      document.getElementById('baseline-score').textContent = baselineScore ? baselineScore.toFixed(2) : 'N/A';
      
      // Update emoji based on comparison
      const emojiElement = document.getElementById('comparison-emoji');
      if (odeScore && baselineScore) {
        if (odeScore > baselineScore) {
          emojiElement.textContent = 'ðŸ˜Š'; // Happy emoji - Pindar scores higher
          emojiElement.title = 'Pindar scores higher than baseline!';
        } else {
          emojiElement.textContent = 'ðŸ˜”'; // Sad emoji - Baseline scores higher
          emojiElement.title = 'Baseline scores higher than Pindar';
        }
      } else {
        emojiElement.textContent = 'ðŸ¤”'; // Thinking emoji - missing data
        emojiElement.title = 'Data unavailable';
      }
      
      debugLog('Responsion attribute: ' + responsionAttribute);
      debugLog('Ode score: ' + (odeScore || 'N/A'));
      debugLog('Baseline score: ' + (baselineScore || 'N/A'));
      debugLog('Emoji: ' + emojiElement.textContent);
      
      // Track loading states
      let heatmapLoaded = false;
      let baselineLoaded = false;
      
      function checkBothLoaded() {
        if (heatmapLoaded && baselineLoaded) {
          heatmapPair.style.display = 'flex';
          errorMessage.style.display = 'none';
          debugLog('SUCCESS: Both images loaded!');
          
          // Add click handlers for modal
          heatmapImg.onclick = function() {
            openModal(heatmapImg.src, heatmapImg.alt);
          };
          
          baselineImg.onclick = function() {
            openModal(baselineImg.src, baselineImg.alt);
          };
        }
      }
      
      // Heatmap load handlers
      heatmapImg.onload = function() {
        heatmapLoaded = true;
        debugLog('SUCCESS: Heatmap loaded!');
        checkBothLoaded();
      };
      
      heatmapImg.onerror = function() {
        debugLog('ERROR: Failed to load heatmap!');
        heatmapPair.style.display = 'none';
        errorMessage.style.display = 'block';
      };
      
      // Baseline load handlers
      baselineImg.onload = function() {
        baselineLoaded = true;
        debugLog('SUCCESS: Baseline loaded!');
        checkBothLoaded();
      };
      
      baselineImg.onerror = function() {
        debugLog('ERROR: Failed to load baseline!');
        heatmapPair.style.display = 'none';
        errorMessage.style.display = 'block';
      };
      
      // Hide initially while loading
      heatmapPair.style.display = 'none';
      errorMessage.style.display = 'none';
      
    } else {
      debugLog('ERROR: Heatmap not in available list');
      heatmapPair.style.display = 'none';
      errorMessage.style.display = 'block';
    }
  }
  
  // Modal functionality for fullscreen images
  function openModal(imageSrc, imageAlt) {
    const modal = document.getElementById('image-modal');
    const modalImage = document.getElementById('modal-image');
    
    debugLog('Opening modal with image: ' + imageSrc);
    debugLog('Modal element found: ' + !!modal);
    debugLog('Modal image element found: ' + !!modalImage);
    
    modalImage.src = imageSrc;
    modalImage.alt = imageAlt;
    modal.style.display = 'block';
    
    // Prevent body scrolling when modal is open
    document.body.style.overflow = 'hidden';
    
    debugLog('Modal opened: ' + imageAlt);
    debugLog('Modal display style: ' + modal.style.display);
    
    // Add load event listener for debugging
    modalImage.onload = function() {
      debugLog('Modal image loaded successfully');
      debugLog('Modal image dimensions: ' + modalImage.naturalWidth + 'x' + modalImage.naturalHeight);
      debugLog('Modal image visible: ' + (modalImage.offsetWidth > 0 && modalImage.offsetHeight > 0));
    };
    
    modalImage.onerror = function() {
      debugLog('ERROR: Modal image failed to load!');
    };
  }
  
  function closeModal() {
    const modal = document.getElementById('image-modal');
    modal.style.display = 'none';
    
    // Restore body scrolling
    document.body.style.overflow = 'auto';
    
    debugLog('Modal closed');
  }
  
  // Modal event listeners
  document.getElementById('modal-close').addEventListener('click', closeModal);
  document.getElementById('modal-overlay').addEventListener('click', closeModal);
  
  // Close modal with Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeModal();
    }
  });
  
  // Add event listeners
  document.getElementById('collection').addEventListener('change', function() {
    updateNumberOptions();
    updateHeatmap();
  });
  document.getElementById('unit').addEventListener('change', function() {
    updateNumberOptions();
    updateHeatmap();
  });
  document.getElementById('number').addEventListener('change', updateHeatmap);
  document.getElementById('overlay').addEventListener('change', updateHeatmap);
  
  // Initialize number dropdown and load initial heatmap
  updateNumberOptions();
  updateHeatmap();
</script>
